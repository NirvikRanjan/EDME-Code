@model AutoSherpa_project.Models.insurancecompany
@{
    ViewBag.Title = "addinsuranceCompany";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Ajax.BeginForm("saveICdetails", "SuperAdmin", new AjaxOptions { OnSuccess = "saveComplete", OnFailure = "saveFailure", HttpMethod = "POST" }))
{
    @Html.HiddenFor(model => model.id)

    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Insurance Company Details
                </div>
                <div class="panel-body">
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label>Company Name</label>
                                    @Html.TextBoxFor(model => model.companyName, new { @class = "form-control", @id = "txtcompanyname" })
                                </div>
                            </div>

                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label>Insurance Code</label>
                                    @Html.TextBoxFor(model => model.iccode, new { @class = "form-control", @id = "txticcode", @maxlength = "10" })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="pull-right">
                                <input type="button" value="Clear" id="btnclear" onclick="clearControl();" class="btn btn-danger" />
                                <input type="submit" value="Save" id="btnsbmt" class="btn btn-success" />
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
}


<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-primary">
            <div class="panel-heading">
                Insurance Company Details
            </div>
            <div class="panel-body">
                <table id="inscompanydetails" class="table table-striped table-bordered tblIns table-hover" width="100%">
                    <thead>
                        <tr>
                            <th>Company Name</th>
                            <th>IC Code</th>
                            <th>Is Active</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>



@section scripts
{
    <script>

        $(document).ready(function () {
            GetDetails();
        });
        function GetDetails() {
          var insuranceDT=  $("#inscompanydetails").DataTable(
                {
                    "destroy": true,
                    "ajax": {
                        "url": siteRoot + "/SuperAdmin/getinsuranceCompanies",
                        "type": "GET",
                        "datatype": "json",
                        "error": function (xhr, error, thrown) { console.log(xhr, error, thrown); }

                    },
                    "columns": [
                        { "data": "companyName", "name": "companyName" },
                        { "data": "iccode", "name": "iccode" },
                        {
                            "data": "isactive", render: function (data, type, row) {
                                if (row.isactive == true) {
                                    return `<a href="javascript:void(0);" onclick="insurancecompanyActions(${row.id} ,'Deactivate');" style="color:green">Deactivate</a>`;

                                }
                                else {
                                    return `<a href="javascript:void(0);" onclick="insurancecompanyActions(${row.id} ,'Activate');" style="color:red">Activate</a>`;

                                }
                            }
                        },

                        {
                            "data": "Action", render: function (data, type, row) {
                                return `<button class="btn btn-danger" onclick="insurancecompanyActions(${row.id},'Delet')"; >Delete</button>`;

                            }
                        },
                    ],
                    "processing": "true",
                    "serverSide": false,
                    "scrollX": "true",
                    "scrollY": "510",
                    "paging": true,
                    "searching": true,
                    "language": {
                        "processing": "Loading Please Wait.....!"
                    },
                    "initComplete": function (data) {
                        insuranceDT.columns(3).visible(false)

                        var exception = data.json.exception;
                        if (exception != "" && exception != null) {
                            Lobibox.notify('warning', {
                                continueDelayOnInactiveTab: true,
                                msg: exception
                            });
                        }
                    }
                });
        }

        $('#btnsbmt').click(function () {
            var Company_Name = $("#txtcompanyname").val();
            var IC_Code = $("#txticcode").val();

            if (Company_Name == '' && IC_Code == '') {
                Lobibox.notify('warning', {
                    continueDelayOnInactiveTab: true,
                    msg: 'Please Enter The Mandatory Fields .'
                });
                return false;

            }
            if (Company_Name == '') {
                Lobibox.notify('warning', {
                    continueDelayOnInactiveTab: true,
                    msg: 'Please Enter IC Name'
                });
                return false;
            }
            if (IC_Code == '') {
                Lobibox.notify('warning', {
                    continueDelayOnInactiveTab: true,
                    msg: 'Please Enter IC Code'
                });
                return false;
            }
            $('#mainLoader').css({ 'display': 'block' });
        })
        function saveComplete(data) {
            $('#mainLoader').css({ 'display': 'none' });

            if (data.success == true) {
                Lobibox.notify('success', {
                    continueDelayOnInactiveTab: true,
                    msg: 'Saved Successfully.'
                });
            }
            if (data.success == false) {
                Lobibox.notify('warning', {
                    continueDelayOnInactiveTab: true,
                    msg: data.error
                });
            }
           
            clearControl();
            GetDetails();
        }

        function saveFailure(data) {
            $('#mainLoader').css({ 'display': 'none' });
            Lobibox.notify('warning', {
                continueDelayOnInactiveTab: true,
                msg: 'Error Occured While SAving Data'
            });
        }

        $("#txtcompanyname").keypress(function (e) {
            var code = e.keyCode || e.which;
            if ((code < 65 || code > 90) && (code < 97 || code > 122) && code != 32 && code != 46) {

                return false;
            }
        });
        $("#txticcode").keydown(function (event) {
            // Allow only backspace and delete
            if (event.keyCode == 46 || event.keyCode == 8) {
                // let it happen, don't do anything
            }
            else {
                // Ensure that it is a number and stop the keypress
                if (event.keyCode < 48 || event.keyCode > 57) {
                    event.preventDefault();

                }
            }
        });


        function insurancecompanyActions(id, actionType) {
            var msg;
            if (actionType == "Delet") {
                msg = "Are you sure you want to delete this Dealer?";
            }
            else if (actionType == "Activate") {
                msg = "Are you sure you want to Activate this Dealer?";
            }
            else if (actionType == "Deactivate") {
                msg = "Are you sure you want to Deactivate this Dealer?";
            }


            Lobibox.confirm({
                msg: msg,
                callback: function ($this, type) {
                    if (type === 'yes') {
                        $('#mainLoader').css({ 'display': 'block' });

                        $.ajax({
                            type: 'POST',
                            "url": "/SuperAdmin/insurancecompanyActions",
                            datatype: 'json',
                            data: { id: id, actionType: actionType },
                            success: function (res) {
                                if (res.success == true) {
                                    if (res.message == "Activate") {

                                        Lobibox.notify('success', {
                                            continueDelayOnInactiveTab: true,
                                            msg: 'Activated Successfully'
                                        });
                                    }
                                    else if (res.message == "Deactivate") {
                                        Lobibox.notify('success', {
                                            continueDelayOnInactiveTab: true,
                                            msg: 'Deactivated Successfully'

                                        });
                                    }
                                    else if (res.message == "Delet") {
                                        Lobibox.notify('error', {
                                            continueDelayOnInactiveTab: true,
                                            msg: 'Deleted Successfully'
                                        });
                                    }
                                    else {
                                        Lobibox.notify('info', {
                                            continueDelayOnInactiveTab: true,
                                            msg: 'Something Went Wrong!'
                                        });
                                    }
                                    GetDetails();
                                    $('#mainLoader').css({ 'display': 'none' });
                                }
                                else if (res.success == false) {
                                    Lobibox.notify('warning', {
                                        continueDelayOnInactiveTab: true,
                                        msg: res.message
                                    });
                                    $('#mainLoader').css({ 'display': 'none' });
                                }
                            }, error(error) {
                                $('#mainLoader').css({ 'display': 'none' });

                            }
                        });
                    }
                }
            });
        }

        function clearControl() {
             $("#txtcompanyname").val('');
             $("#txticcode").val('');

        }
    </script>
}
